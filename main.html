<?php
session_start();
include "server.php"; // <-- MOVE ALL PHP HERE
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Management System</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<link rel="stylesheet" href="main.css">
</head>

<body>

<?php if (!isset($_SESSION['username'])): ?>
<div class="container-auth">
    <div class="logo-header">
        <i class="fa-solid fa-rocket"></i>
        <h1>Student Management System</h1>
    </div>

    <?php if (!empty($error)) echo "<div class='text-red-500 mb-2'>$error</div>"; ?>
    <?php if (!empty($success)) echo "<div class='text-green-400 mb-2'>$success</div>"; ?>

    <form id="loginForm" method="post">
        <input type="hidden" name="action" value="login">
        <input type="text" name="username" placeholder="Username" required>

        <div class="input-group">
            <input type="password" name="password" id="loginPassword" placeholder="Password" required>
            <i class="fa fa-eye" id="toggleLoginPassword"></i>
        </div>

        <button type="submit">Login</button>
    </form>

    <form id="registerForm" method="post" class="hidden mt-2">
        <input type="hidden" name="action" value="register">

        <input type="text" name="username" placeholder="Username" required>

        <div class="input-group">
            <input type="password" name="password" id="registerPassword" placeholder="Password" required>
            <i class="fa fa-eye" id="toggleRegisterPassword"></i>
        </div>

        <div class="input-group">
            <input type="password" name="confirm" id="confirmPassword" placeholder="Confirm Password" required>
            <i class="fa fa-eye" id="toggleConfirmPassword"></i>
        </div>

        <button type="submit">Register</button>
    </form>

    <div class="toggle" id="toggleForm">Switch to Register</div>
</div>

<script src="main.js"></script>

<?php else: ?>

<div class="dashboard">
    <div class="dashboard-header">
        <div class="logo-header">
            <i class="fa-solid fa-rocket"></i>
            <h1>Student Management System</h1>
        </div>

        <form method="post">
            <input type="hidden" name="action" value="logout">
            <button class="logout-btn">
                <i class="fa-solid fa-right-from-bracket"></i> Logout
            </button>
        </form>
    </div>

    <form id="studentForm" method="post" class="student-form grid grid-cols-1 md:grid-cols-5 gap-3">
        <input type="hidden" name="action" id="formAction" value="add">
        <input type="hidden" name="id" id="studentId">

        <input type="text" name="name" id="name" placeholder="Full Name" required>
        <input type="email" name="email" id="email" placeholder="Email" required>
        <input type="text" name="course" id="course" placeholder="Course" required>
        <input type="number" name="age" id="age" placeholder="Age" required>

        <button type="submit" id="submitBtn" class="col-span-1 md:col-span-5">
            <i class="fa-solid fa-plus"></i> Add
        </button>
    </form>

    <div class="table-search">
        <input type="text" id="searchInput" placeholder="Search students...">
    </div>

    <div class="table-container mt-2">
        <table class="table table-dark table-hover align-middle">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Course</th>
                    <th>Age</th>
                    <th>Actions</th>
                </tr>
            </thead>

            <tbody>
            <?php $count = 1; while ($row = $students->fetch_assoc()): ?>
                <tr>
                    <td><?= $count++; ?></td>
                    <td><?= htmlspecialchars($row['name']); ?></td>
                    <td><?= htmlspecialchars($row['email']); ?></td>
                    <td><?= htmlspecialchars($row['course']); ?></td>
                    <td><?= $row['age']; ?></td>

                    <td>
                        <button type="button" class="btn btn-sm btn-warning edit-btn"
                            data-id="<?= $row['id']; ?>"
                            data-name="<?= htmlspecialchars($row['name']); ?>"
                            data-email="<?= htmlspecialchars($row['email']); ?>"
                            data-course="<?= htmlspecialchars($row['course']); ?>"
                            data-age="<?= $row['age']; ?>">
                            <i class="fa-solid fa-pen"></i>
                        </button>

                        <form method="post" class="d-inline">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="id" value="<?= $row['id']; ?>">
                            <button class="btn btn-sm btn-danger">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            <?php endwhile; ?>
            </tbody>
        </table>
    </div>
</div>

<script src="main.js"></script>

<?php endif; ?>
</body>
</html>
